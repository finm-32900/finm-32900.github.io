

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Unit Tests &#8212; Data Science Tools for Finance</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/Week5/unit_tests';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Week 6: Bloomberg and Social Coding with GitHub" href="../Week6/overview_w6.html" />
    <link rel="prev" title="Sphinx" href="sphinx.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Data Science Tools for Finance - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Data Science Tools for Finance - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data Science Tools for Finance
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Course Syllabus: FINM 32900, Winter 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Week1/HW0.html">Homework 0: Setting up your computing environment</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week1/overview_w1.html">Week 1: Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week1/what_is_this_course_about.html">What is Data Science? Where does this course fit in?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week1/reproducible_analytical_pipelines.html">What are Reproducible Analytical Pipelines?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week1/case_study_reproducibility_in_finance.html">Case Study: Is There A Reproducibility Crisis In Finance?</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week1/HW1.html">Homework 1</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../output/_01_repo_spikes.html">Rate Spikes in the Market for Repurchase Agreements</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week2/overview_w2.html">Week 2: Build Systems and Task Runners</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week2/virtual_environments.html">Virtual Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/what_is_a_build_system.html">What is a build system or task runner?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/project_structure.html">Project Structure</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week2/HW2.html">Homework 2</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week2/case_study_atlanta_fed_wage_growth_tracker.html">Case Study: Atlanta Fed Wage Growth Tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../output/_01_wage_growth_during_the_recession.html">HW Guide: Wage Growth During the Recession</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week3/overview_w3.html">Week 3: Env Files, Secrets, Automating Queries, and the Basics of SQL</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week3/WRDS_intro_and_web_queries.html">Introduction to WRDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../output/_01_wrds_python_package.html">Example: Connecting to the WRDS Platform With Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week3/env_files.html">Env Files and the Separations of Settings from Code</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week3/HW3.html">Homework 3</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../output/_02_CRSP_market_index.html">HW Guide Part A: CRSP Market Returns Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../output/_03_Fama_French_1993.html">HW Guide Part B: Replicate Fama-French 1993</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week4/overview_w4.html">Week 4: Generating Reports, featuring Jupyter Notebooks and LaTeX</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week4/reports_with_jupyter_notebooks.html">Reports with Jupyter Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week4/intro_to_LaTeX.html">Introduction to LaTeX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week4/latex_essentials.html">LaTeX Essentials</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="overview_w5.html">Week 5: Unit Tests and Documentation with Sphinx</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sphinx.html">Sphinx</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Unit Tests</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week6/overview_w6.html">Week 6: Bloomberg and Social Coding with GitHub</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week6/bloomberg_terminal.html">The Bloomberg Terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week6/GitHub_pull_requests.html">GitHub Pull Requests: Enhancing Collaborative Development</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Week7/overview_w7.html">Week 7: Reviewing Sphinx and Unit Tests</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Misc/final_project.html">Final Project</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Misc/potential_final_projects.html">List of Potential Final Projects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Misc/appendix.html">Appendix</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/finm-32900/finm-32900-data-science" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/finm-32900/finm-32900-data-science/issues/new?title=Issue%20on%20page%20%2Flectures/Week5/unit_tests.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/lectures/Week5/unit_tests.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Unit Tests</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-unit-tests-in-a-test-file">Standard: Unit Tests in a Test File</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-makes-a-good-unit-test">What Makes a Good Unit Test?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-tests">Running the Tests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doctests-or-unit-tests-in-docstrings">“Doctests” or Unit Tests in Docstrings</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-doctests">Writing Doctests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-doctests">Running Doctests</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="unit-tests">
<h1>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this heading">#</a></h1>
<p>Unit testing is an essential part of developing reliable, maintainable software. By following these steps and best practices, you can create effective unit tests for your Python functions, ensuring they behave as intended under various conditions.</p>
<section id="standard-unit-tests-in-a-test-file">
<h2>Standard: Unit Tests in a Test File<a class="headerlink" href="#standard-unit-tests-in-a-test-file" title="Permalink to this heading">#</a></h2>
<p>Creating unit tests in separate test files is a fundamental practice in software development, ensuring your code works as expected through automated tests. This brief tutorial will explain how to write unit tests for a Python function called <code class="docutils literal notranslate"><span class="pre">weighted_average</span></code> using a test function named <code class="docutils literal notranslate"><span class="pre">test_weighted_average</span></code> located in a file called <code class="docutils literal notranslate"><span class="pre">test_misc_tools.py</span></code>.</p>
<section id="what-makes-a-good-unit-test">
<h3>What Makes a Good Unit Test?<a class="headerlink" href="#what-makes-a-good-unit-test" title="Permalink to this heading">#</a></h3>
<p>A good unit test should be:</p>
<ul class="simple">
<li><p><strong>Specific</strong>: It tests a single aspect of the function’s behavior.</p></li>
<li><p><strong>Isolated</strong>: It does not rely on external systems or complex setup.</p></li>
<li><p><strong>Repeatable</strong>: It can be run multiple times and will produce the same results.</p></li>
<li><p><strong>Readable</strong>: It clearly conveys what is being tested and what the expected outcome is.</p></li>
<li><p><strong>Comprehensive</strong>: It covers both typical use cases and edge cases.</p></li>
</ul>
<p>Furthermore, some best practices would be to</p>
<ul class="simple">
<li><p><strong>Test One Thing at a Time</strong>: Each test function should test a single behavior of the function.</p></li>
<li><p><strong>Use Descriptive Test Names</strong>: The name of the test function should describe what aspect of the function it’s testing.</p></li>
<li><p><strong>Arrange-Act-Assert Pattern</strong>: Organize your test into three sections: setting up data (<code class="docutils literal notranslate"><span class="pre">Arrange</span></code>), calling the function (<code class="docutils literal notranslate"><span class="pre">Act</span></code>), and asserting the outcome (<code class="docutils literal notranslate"><span class="pre">Assert</span></code>).</p></li>
<li><p><strong>Handle Exceptions</strong>: If your function can raise exceptions, write tests to ensure these exceptions are raised under the correct conditions.</p></li>
</ul>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h3>
<p>Here’s a concise example based on the provided <code class="docutils literal notranslate"><span class="pre">weighted_average</span></code> function and its test.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="k">def</span> <span class="nf">weighted_average</span><span class="p">(</span><span class="n">data_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple calculation of weighted average.</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; df_nccb = pd.DataFrame({</span>
<span class="sd">    ...     &#39;rate&#39;: [2, 3, 2],</span>
<span class="sd">    ...     &#39;start_leg_amount&#39;: [100, 200, 100]},</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; weighted_average(data_col=&#39;rate&#39;, weight_col=&#39;start_leg_amount&#39;, data=df_nccb)</span>
<span class="sd">    2.5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weights_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">weight_col</span><span class="p">]</span>
    <span class="n">wm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights_function</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data_col</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>

</pre></div>
</div>
<p>And the test</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">misc_tools</span> <span class="kn">import</span> <span class="n">weighted_average</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">test_weighted_average</span><span class="p">():</span>
    <span class="c1"># Set up test data</span>
    <span class="n">df_nccb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
        <span class="s2">&quot;start_leg_amount&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
    <span class="p">})</span>
    <span class="c1"># Call the function</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">weighted_average</span><span class="p">(</span><span class="n">data_col</span><span class="o">=</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="s2">&quot;start_leg_amount&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_nccb</span><span class="p">)</span>
    <span class="c1"># Expected result</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="c1"># Assert function output is as expected</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">expected</span><span class="p">,</span> <span class="s2">&quot;The weighted_average function should return 2.5&quot;</span>
</pre></div>
</div>
</section>
<section id="running-the-tests">
<h3>Running the Tests<a class="headerlink" href="#running-the-tests" title="Permalink to this heading">#</a></h3>
<p>To run your tests, use the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> command in the terminal:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>test_misc_tools.py
</pre></div>
</div>
<p>or just</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pytest
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> will automatically find and run all test functions defined in the specified file, reporting any failures so you can address them.</p>
</section>
</section>
<section id="doctests-or-unit-tests-in-docstrings">
<h2>“Doctests” or Unit Tests in Docstrings<a class="headerlink" href="#doctests-or-unit-tests-in-docstrings" title="Permalink to this heading">#</a></h2>
<p>Writing unit tests within docstrings, a practice known as doctest, is an efficient way to both document and test your code simultaneously. Here’s a quick walkthrough of writing effective unit tests as docstrings, using the provided Python functions <code class="docutils literal notranslate"><span class="pre">create_lagged_columns</span></code> and <code class="docutils literal notranslate"><span class="pre">with_lagged_columns</span></code> within the <code class="docutils literal notranslate"><span class="pre">misc_tools.py</span></code> module in <a class="github reference external" href="https://github.com/jmbejara/blank_project">jmbejara/blank_project</a> as examples.</p>
<section id="writing-doctests">
<h3>Writing Doctests<a class="headerlink" href="#writing-doctests" title="Permalink to this heading">#</a></h3>
<p>Doctests are written in the docstring of a Python function, module, or class. They are written in the form of an interactive Python session.</p>
<p><strong>Syntax</strong></p>
<ul class="simple">
<li><p><strong>Prompt lines</strong> (<code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code>): This is where you call your function or write expressions.</p></li>
<li><p><strong>Output lines</strong>: This is the expected output from the prompt line directly above it.</p></li>
<li><p><strong>Blank lines</strong>: A single blank line indicates the end of a test. Multiple blank lines can be used for readability.</p></li>
</ul>
</section>
<section id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>Code to be tested:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>

<span class="k">def</span> <span class="nf">create_lagged_columns</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns_to_lag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">id_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                         <span class="n">date_col</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">):</span>

    <span class="n">all_dates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">date_col</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">date_to_lag_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">all_dates</span><span class="p">,</span> <span class="n">all_dates</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">lags</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">date_to_lag_date</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_col</span><span class="p">,</span> <span class="s1">&#39;_lagged_date&#39;</span><span class="p">]</span>

    <span class="n">sub_df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">date_col</span><span class="p">,</span> <span class="o">*</span><span class="n">id_columns</span><span class="p">,</span> <span class="o">*</span><span class="n">columns_to_lag</span><span class="p">]]</span>
    <span class="n">lag_sub_df</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">date_to_lag_date</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">date_col</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns_to_lag</span><span class="p">:</span>
        <span class="n">lag_sub_df</span> <span class="o">=</span> <span class="n">lag_sub_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">lags</span><span class="si">}</span><span class="s1">_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">})</span>

    <span class="n">lag_sub_df</span> <span class="o">=</span> <span class="n">lag_sub_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">date_col</span><span class="p">])</span>
    <span class="n">lag_sub_df</span> <span class="o">=</span> <span class="n">lag_sub_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_lagged_date&#39;</span><span class="p">:</span><span class="n">date_col</span><span class="p">})</span>
    
    <span class="k">return</span> <span class="n">lag_sub_df</span>

<span class="k">def</span> <span class="nf">with_lagged_columns</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns_to_lag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">id_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                         <span class="n">date_col</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; a=[[1,&#39;1990/1/1&#39;,1],</span>
<span class="sd">    ... [1,&#39;1990/2/1&#39;,2],</span>
<span class="sd">    ... [1,&#39;1990/3/1&#39;,3],</span>
<span class="sd">    ... [2,&#39;1989/12/1&#39;,3],</span>
<span class="sd">    ... [2,&#39;1990/1/1&#39;,3],</span>
<span class="sd">    ... [2,&#39;1990/2/1&#39;,4],</span>
<span class="sd">    ... [2,&#39;1990/3/1&#39;,5.5],</span>
<span class="sd">    ... [2,&#39;1990/4/1&#39;,5],</span>
<span class="sd">    ... [2,&#39;1990/6/1&#39;,6]]</span>

<span class="sd">    &gt;&gt;&gt; data=pd.DataFrame(a,columns=[&#39;id&#39;,&#39;date&#39;,&#39;value&#39;])</span>
<span class="sd">    &gt;&gt;&gt; data[&#39;date&#39;]=pd.to_datetime(data[&#39;date&#39;])</span>

<span class="sd">    &gt;&gt;&gt; data</span>
<span class="sd">       id       date  value</span>
<span class="sd">    0   1 1990-01-01   1.00</span>
<span class="sd">    1   1 1990-02-01   2.00</span>
<span class="sd">    2   1 1990-03-01   3.00</span>
<span class="sd">    3   2 1989-12-01   3.00</span>
<span class="sd">    4   2 1990-01-01   3.00</span>
<span class="sd">    5   2 1990-02-01   4.00</span>
<span class="sd">    6   2 1990-03-01   5.50</span>
<span class="sd">    7   2 1990-04-01   5.00</span>
<span class="sd">    8   2 1990-06-01   6.00</span>

<span class="sd">    &gt;&gt;&gt; data_lag = with_lagged_columns(data=data, columns_to_lag=[&#39;value&#39;], id_columns=[&#39;id&#39;], lags=1)</span>
<span class="sd">    &gt;&gt;&gt; data_lag</span>
<span class="sd">       id       date  value  L1_value</span>
<span class="sd">    0   1 1990-01-01   1.00       NaN</span>
<span class="sd">    1   1 1990-02-01   2.00      1.00</span>
<span class="sd">    2   1 1990-03-01   3.00      2.00</span>
<span class="sd">    3   2 1989-12-01   3.00       NaN</span>
<span class="sd">    4   2 1990-01-01   3.00      3.00</span>
<span class="sd">    5   2 1990-02-01   4.00      3.00</span>
<span class="sd">    6   2 1990-03-01   5.50      4.00</span>
<span class="sd">    7   2 1990-04-01   5.00      5.50</span>
<span class="sd">    8   2 1990-06-01   6.00      5.00</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_lag</span> <span class="o">=</span> <span class="n">create_lagged_columns</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns_to_lag</span><span class="o">=</span><span class="n">columns_to_lag</span><span class="p">,</span> 
                                     <span class="n">id_columns</span><span class="o">=</span><span class="n">id_columns</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> 
                                     <span class="n">date_col</span><span class="o">=</span><span class="n">date_col</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">w_data_lag</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_lag</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">date_col</span><span class="p">,</span> <span class="o">*</span><span class="n">id_columns</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w_data_lag</span>

</pre></div>
</div>
<p>Consider the <code class="docutils literal notranslate"><span class="pre">with_lagged_columns</span></code> function. The doctest within its docstring demonstrates how to use the function and what output to expect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">...</span>
<span class="sd">&gt;&gt;&gt; data_lag = with_lagged_columns(data=data, columns_to_lag=[&#39;value&#39;], id_columns=[&#39;id&#39;], lags=1)</span>
<span class="sd">&gt;&gt;&gt; data_lag</span>
<span class="sd">   id       date  value  L1_value</span>
<span class="sd">0   1 1990-01-01   1.00       NaN</span>
<span class="sd">1   1 1990-02-01   2.00      1.00</span>
<span class="sd">...</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
<section id="running-doctests">
<h3>Running Doctests<a class="headerlink" href="#running-doctests" title="Permalink to this heading">#</a></h3>
<p>To run doctests, you can use the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-modules
</pre></div>
</div>
<p>This command will search for docstrings in all Python modules and run any found doctests.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lectures\Week5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="sphinx.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Sphinx</p>
      </div>
    </a>
    <a class="right-next"
       href="../Week6/overview_w6.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Week 6: Bloomberg and Social Coding with GitHub</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-unit-tests-in-a-test-file">Standard: Unit Tests in a Test File</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-makes-a-good-unit-test">What Makes a Good Unit Test?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-tests">Running the Tests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doctests-or-unit-tests-in-docstrings">“Doctests” or Unit Tests in Docstrings</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-doctests">Writing Doctests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-doctests">Running Doctests</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeremy Bejarano
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>